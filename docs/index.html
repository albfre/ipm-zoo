<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interior-Point Methods Zoo</title>
  <link rel="stylesheet" href="styles.css">
  <script>
    MathJax = {
      tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
      svg: { fontCache: 'global' }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
  <img style="float: left;" src="square-title.svg" height="120">

  <div class="container">
    <!-- Input Section (Left) -->
    <div class="section">
      <h3>Inequalities</h3>
      <label><input type="radio" name="inequalities" value="none"> None</label>
      <label><input type="radio" name="inequalities" value="lower"> Inequalities from below</label>
      <label><input type="radio" name="inequalities" value="upper"> Inequalities from above</label>
      <label><input type="radio" name="inequalities" value="both" checked> Inequalities from below and above</label>
      <br>
      <h3>Equalities</h3>
      <label><input type="checkbox" id="equalities"> Include Equalities</label>
      <br>
      <h3>Variable Bounds</h3>
      <label><input type="radio" name="variable_bounds" value="none"> None</label>
      <label><input type="radio" name="variable_bounds" value="lower"> Lower</label>
      <label><input type="radio" name="variable_bounds" value="upper"> Upper</label>
      <label><input type="radio" name="variable_bounds" value="both" checked> Lower and upper</label>
      <br>
      <h3>Handling of Inequalities</h3>
      <label><input type="radio" name="handling_inequalities" value="slacks" checked> Slacks</label>
      <br>
      <h3>Handling of Equalities (not yet working)</h3>
      <label><input type="radio" name="handling_equalities" value="indefinite" checked> Indefinite
        factorization</label>
      <label><input type="radio" name="handling_equalities" value="slacks"> Slacks</label>
      <label><input type="radio" name="handling_equalities" value="penalty"> Penalty function</label>
    </div>

    <!-- Output Section (Right) -->
    <div class="output" id="output">
      <h3>Problem Formulation</h3>
      <p>Select options to see the formulation here.</p>
    </div>
  </div>

  <script>
    const x = "x"; // Primary variable
    const Aineq = "A"; // Inequality constraint matrix
    const lAineq = "l_{A}"; // Inequality constraint lower bound
    const uAineq = "u_{A}"; // Inequality constraint upper bound
    const Aeq = "A_{\\text{eq}}"; // Equality constraint matrix
    const beq = "b"; // Equality constraint right-hand side
    const lx = "l_x"; // Primary variable lower bound
    const ux = "u_x"; // Primary variable upper bound
    const sA = "s"; // Slack variable for inequality constraint
    const slA = "g"; // Slack variable for inequality constraint lower bound
    const suA = "t"; // Slack variable for inequality constraint upper bound
    const slx = "y"; // Slack variable for x lower bound
    const sux = "z"; // Slack variable for x upper bound
    const getObjective = (logBarrierVariables = []) => {
      let output = "\\underset{" + x + "}{\\text{minimize}} \\quad & \\frac{1}{2} " + x + "^T Q " + x + " + c^T" + x;
      for (const v of logBarrierVariables) {
        output += "- \\mu e^T \\log(" + v + ")";
      }
      output += " \\\\";
      return output;
    }

    function getOriginalProblem(inequalities, equalities, variableBounds) {
      const hasInequalities = inequalities !== "none";
      const hasEqualities = equalities;
      const hasVariableBounds = variableBounds !== "none";
      let outputText = "";
      outputText += "\\[ \\begin{align*}\n";
      outputText += getObjective();

      if (hasInequalities || hasEqualities || hasVariableBounds) {
        outputText += "\\text{subject to} \\quad";
      }

      if (hasEqualities) {
        outputText += "& " + Aeq + x + " = " + beq + "\\\\\n"
      }

      if (hasInequalities) {
        if (inequalities === "lower") outputText += "& " + Aineq + x + " \\geq " + lAineq + " \\\\\n";
        if (inequalities === "upper") outputText += "& " + Aineq + x + " \\leq " + uAineq + " \\\\\n";
        if (inequalities === "both") outputText += "& " + lAineq + " \\leq " + Aineq + x + " \\leq " + uAineq + " \\\\\n";
      }

      if (variableBounds !== "none") {
        if (variableBounds === "lower") outputText += "& " + x + " \\geq " + lx + " \\\\\n";
        if (variableBounds === "upper") outputText += "& " + x + " \\leq " + ux + " \\\\\n";
        if (variableBounds === "both") outputText += "& " + lx + " \\leq " + x + " \\leq " + ux + " \\\\\n";
      }

      outputText += "\\end{align*} \\]\n"
      return outputText;
    }

    function getNonnegativeSlacks(inequalities, equalities, variableBounds) {
      let nonnegativeSlacks = [];
      if (inequalities === "lower" || inequalities == "both") {
        nonnegativeSlacks.push(slA);
      }
      if (inequalities === "upper" || inequalities == "both") {
        nonnegativeSlacks.push(suA);
      }
      if (variableBounds === "lower" || variableBounds == "both") {
        nonnegativeSlacks.push(slx);
      }
      if (variableBounds === "upper" || variableBounds == "both") {
        nonnegativeSlacks.push(sux);
      }
      return nonnegativeSlacks;
    }

    function getSlackProblem(inequalities, equalities, variableBounds, logBarriers) {
      const hasInequalities = inequalities !== "none";
      const hasEqualities = equalities;
      const hasVariableBounds = variableBounds !== "none";
      let outputText = "";
      outputText += "\\[ \\begin{align*}\n";
      const nonnegativeSlacks = getNonnegativeSlacks(inequalities, equalities, variableBounds);
      outputText += getObjective(logBarriers ? nonnegativeSlacks : []);

      if (hasInequalities || hasEqualities || hasVariableBounds) {
        outputText += "\\text{subject to} \\quad";
      }

      if (hasEqualities) {
        outputText += "& " + Aeq + x + " = " + beq + "\\\\\n"
      }

      if (hasInequalities) {
        outputText += "& " + Aineq + x + " - " + sA + " = 0 \\\\\n";
        if (inequalities === "lower" || inequalities == "both") outputText += "& " + sA + " - " + slA + " = " + lAineq + " \\\\\n";
        if (inequalities === "upper" || inequalities == "both") outputText += "& " + sA + " + " + suA + " = " + uAineq + " \\\\\n";
      }

      if (variableBounds !== "none") {
        if (variableBounds === "lower" || variableBounds == "both") outputText += "& " + x + " - " + slx + " = " + lx + " \\\\\n";
        if (variableBounds === "upper" || variableBounds == "both") outputText += "& " + x + " + " + sux + " = " + ux + " \\\\\n";
      }

      if (!logBarriers && nonnegativeSlacks) {
        outputText += "& " + nonnegativeSlacks.join(", ") + " \\geq 0 \\\\\n"
      }

      outputText += "\\end{align*} \\]\n"
      return outputText;
    }

    function updateProblem() {
      let inequalities = document.querySelector('input[name="inequalities"]:checked').value;
      let handlingInequalities = "Slacks"; // Only one option
      let equalities = document.getElementById("equalities").checked;
      let handlingEqualities = document.querySelector('input[name="handling_equalities"]:checked').value;
      let variableBounds = document.querySelector('input[name="variable_bounds"]:checked').value;

      const hasInequalities = inequalities !== "none";
      const hasEqualities = equalities;
      const hasVariableBounds = variableBounds !== "none";

      let outputText = ""; //<h3>Quadratic Programming Problem</h3>";
      outputText += "<p><strong>Original optimization problem:</strong></p>";
      outputText += getOriginalProblem(inequalities, equalities, variableBounds);

      if (hasInequalities || hasVariableBounds) {
        outputText += "<p><strong>Slacked optimization problem:</strong></p>";
        outputText += getSlackProblem(inequalities, equalities, variableBounds, false);

        outputText += "<p><strong>Slacked optimization problem with log-barriers:</strong></p>";
        outputText += getSlackProblem(inequalities, equalities, variableBounds, true);
      }

      outputText += "<h3>Interior-Point Method Derivation</h3>";
      outputText += "<p>1. Optimization problem with slacks</p>";
      outputText += "<p>2. Optimization problem with barriers</p>";
      outputText += "<p>3. Lagrangian formulation</p>";
      outputText += "<p>4. First-order optimality conditions</p>";
      outputText += "<p>5. Newton system</p>";
      outputText += "<p>6. Reduction of rows for log-barriers</p>";
      outputText += "<p>7. Reduction of rows for Lagrange multipliers</p>";
      outputText += "<p>8. Augmented system and LU/LDLT solution methods</p>";
      outputText += "<p>9. Reduction to normal equations if possible</p>";

      document.getElementById("output").innerHTML = outputText;
      MathJax.typesetPromise().catch((err) => {
        console.error("MathJax error:", err);
      });
    }

    document.querySelectorAll('input').forEach(input => {
      input.addEventListener('change', updateProblem);
    });

    updateProblem();
  </script>

</body>

</html>